<!-- wp:template-part {"slug":"header","tagName":"header"} /-->

<!-- wp:group {"tagName":"main","style":{"spacing":{"padding":{"top":"0","bottom":"0","left":"0","right":"0"}}},"layout":{"type":"default"}} -->
<main class="wp-block-group" style="padding-top:0;padding-right:0;padding-bottom:0;padding-left:0">

    <!-- wp:group {"className":"heading","style":{"spacing":{"padding":{"top":"2rem","bottom":"2rem"}}},"backgroundColor":"light-gray","layout":{"type":"full"}} -->
    <div class="wp-block-group heading has-light-gray-background-color has-background" style="padding-top:2rem;padding-bottom:2rem">
                <!-- wp:group {"layout":{"type":"constrained"}} -->
            <div class="wp-block-group">
                <!-- wp:post-title {"level":1,"style":{"typography":{"fontSize":"2.5rem","fontWeight":"700"}}} /-->
            </div>
        <!-- /wp:group -->
    </div>
    <!-- /wp:group -->

    <!-- wp:group {"style":{"spacing":{"padding":{"top":"2rem","bottom":"2rem"}}},"layout":{"type":"constrained"}} -->
    <div class="wp-block-group" style="padding-top:2rem;padding-bottom:2rem">
        
        <!-- wp:post-content /-->
        
        <!-- wp:html -->
        <div class="loader-img" style="display: none; text-align: center; margin: 20px 0;">
            <img alt="Loading" src="/wp-content/themes/tyler-4update/assets/images/ajax-loader.gif" width="32" height="32" />
        </div>
        
        <div class="schedule-container">
            <div class="schedule-filters">
                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="track-filter">Filter by Track:</label>
                        <select id="track-filter" class="filter-select">
                            <option value="0">All Tracks</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="location-filter">Filter by Location:</label>
                        <select id="location-filter" class="filter-select">
                            <option value="0">All Locations</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="date-filter">Filter by Date:</label>
                        <select id="date-filter" class="filter-select">
                            <option value="0">All Dates</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="sessions-list">
                <!-- Sessions will be loaded here via JavaScript -->
            </div>
        </div>

        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sessionType = 'sessionfour';
            let allSessions = [];
            let filteredSessions = [];
            
            // Initialize filters and load data
            initializeSchedule();
            
            function initializeSchedule() {
                showLoader();
                
                // Load session data via AJAX
                fetch('/wp-admin/admin-ajax.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `action=get_sessions&session_type=${sessionType}`
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    try {
                        const data = JSON.parse(text);
                        if (data.success) {
                            allSessions = data.data.sessions || [];
                            populateFilters(data.data.tracks || [], data.data.locations || [], data.data.dates || []);
                            filterSessions();
                        } else {
                            console.error('AJAX Error:', data.data);
                            showError('Failed to load sessions: ' + (data.data || 'Unknown error'));
                        }
                    } catch (parseError) {
                        console.error('JSON Parse Error:', parseError);
                        console.error('Response text:', text);
                        showError('The AJAX handler is not set up yet. Please add the backend code to your functions.php file.');
                    }
                    hideLoader();
                })
                .catch(error => {
                    console.error('Network Error:', error);
                    showError('Network error: ' + error.message);
                    hideLoader();
                });
                
                // Add event listeners for filters
                document.getElementById('track-filter').addEventListener('change', filterSessions);
                document.getElementById('location-filter').addEventListener('change', filterSessions);
                document.getElementById('date-filter').addEventListener('change', filterSessions);
            }
            
            function populateFilters(tracks, locations, dates) {
                const trackFilter = document.getElementById('track-filter');
                const locationFilter = document.getElementById('location-filter');
                const dateFilter = document.getElementById('date-filter');
                
                // Populate tracks
                tracks.forEach(track => {
                    const option = document.createElement('option');
                    option.value = track.term_id;
                    option.textContent = track.name;
                    trackFilter.appendChild(option);
                });
                
                // Populate locations
                locations.forEach(location => {
                    const option = document.createElement('option');
                    option.value = location.term_id;
                    option.textContent = location.name;
                    locationFilter.appendChild(option);
                });
                
                // Populate dates
                dates.forEach(date => {
                    if (date.meta_value !== "1580688000") {
                        const option = document.createElement('option');
                        option.value = date.meta_value;
                        option.textContent = formatDate(date.meta_value);
                        dateFilter.appendChild(option);
                    }
                });
            }
            
            function filterSessions() {
                const trackFilter = document.getElementById('track-filter').value;
                const locationFilter = document.getElementById('location-filter').value;
                const dateFilter = document.getElementById('date-filter').value;
                
                
                filteredSessions = allSessions.filter(session => {
                    // Convert to strings for comparison since HTML select values are strings
                    const trackMatch = trackFilter === '0' || String(session.track_id) === String(trackFilter);
                    const locationMatch = locationFilter === '0' || String(session.location_id) === String(locationFilter);
                    const dateMatch = dateFilter === '0' || String(session.date) === String(dateFilter);                   
                  
                    
                    return trackMatch && locationMatch && dateMatch;
                });
                
                displaySessions();
            }
            
            function displaySessions() {
                const container = document.querySelector('.sessions-list');
                
                if (filteredSessions.length === 0) {
                    container.innerHTML = '<div class="no-sessions">No sessions found matching your filters.</div>';
                    return;
                }
                
                const sessionsHTML = filteredSessions.map(session => `
                    <div class="sessions list session-item session" data-track="${session.track_id}" data-location="${session.location_id}" data-date="${session.date}">

                    <span class="time">${session.start_time} - ${session.end_time}</span>
                    <div class="session-inner">
                        
                        <a href="${session.url}" class="title">
                            <div class="session-title">${session.title}</div>
                        </a>
                        
                        <span class="speakers-thumbs"></span>

                        <a href="${session.url}" class="more">
                            More info<i class="icon-angle-right"></i>
                        </a>
                    </div>                     

                    </div>
                `).join('');
                
                container.innerHTML = sessionsHTML;
            }
            
            function formatDate(timestamp) {
                const date = new Date(timestamp * 1000);
                return date.toLocaleDateString();
            }
            
            function showLoader() {
                document.querySelector('.loader-img').style.display = 'block';
            }
            
            function hideLoader() {
                document.querySelector('.loader-img').style.display = 'none';
            }
            
            function showError(message) {
                const container = document.querySelector('.sessions-list');
                container.innerHTML = `<div class="error-message" style="background: #ffebee; color: #c62828; padding: 1rem; border-radius: 4px; margin: 1rem 0;">${message}</div>`;
            }
        });
        </script>
        <!-- /wp:html -->
        
    </div>
    <!-- /wp:group -->

</main>
<!-- /wp:group -->

<!-- wp:template-part {"slug":"footer","tagName":"footer"} /-->